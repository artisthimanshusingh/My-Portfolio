<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Portfolio</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Hero Section -->
  <section class="hero">
    <h1>Welcome to My Portfolio</h1>
    <p>Explore my work below!</p>
  </section>

  <!-- Gallery Section -->
  <section class="gallery">
    <div class="image-card" data-id="image1">
      <img src="images/pic1.jpg" alt="Artwork 1">
      <div class="actions">
        <button class="like-btn" data-id="image1">‚ù§Ô∏è Like (<span id="likes-image1">0</span>)</button>
        <button class="share-btn" data-id="image1">üîó Share</button>
      </div>
      <div class="comments">
        <input type="text" placeholder="Add a comment..." class="comment-input" data-id="image1">
        <button class="comment-btn" data-id="image1">Post</button>
        <ul id="comments-image1"></ul>
      </div>
    </div>

    <div class="image-card" data-id="image2">
      <img src="images/pic2.jpg" alt="Artwork 2">
      <div class="actions">
        <button class="like-btn" data-id="image2">‚ù§Ô∏è Like (<span id="likes-image2">0</span>)</button>
        <button class="share-btn" data-id="image2">üîó Share</button>
      </div>
      <div class="comments">
        <input type="text" placeholder="Add a comment..." class="comment-input" data-id="image2">
        <button class="comment-btn" data-id="image2">Post</button>
        <ul id="comments-image2"></ul>
      </div>
    </div>
  </section>

  <!-- Firebase + App Script -->
  <script type="module">
    import { db } from "./firebase.js";
    import {
      doc, getDoc, setDoc, updateDoc, increment, collection, addDoc, query, onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    // --- LIKE BUTTON ---
    document.querySelectorAll(".like-btn").forEach(button => {
      button.addEventListener("click", async () => {
        const id = button.dataset.id;
        const docRef = doc(db, "likes", id);
        const snap = await getDoc(docRef);

        if (snap.exists()) {
          await updateDoc(docRef, { count: increment(1) });
        } else {
          await setDoc(docRef, { count: 1 });
        }
      });
    });

    // Real-time like counter
    ["image1", "image2"].forEach(id => {
      const docRef = doc(db, "likes", id);
      onSnapshot(docRef, (snap) => {
        if (snap.exists()) {
          document.getElementById(`likes-${id}`).innerText = snap.data().count;
        }
      });
    });

    // --- COMMENTS ---
    document.querySelectorAll(".comment-btn").forEach(button => {
      button.addEventListener("click", async () => {
        const id = button.dataset.id;
        const input = document.querySelector(`.comment-input[data-id="${id}"]`);
        const text = input.value.trim();
        if (!text) return;

        await addDoc(collection(db, "comments", id, "items"), {
          text,
          timestamp: Date.now()
        });
        input.value = "";
      });
    });

    // Real-time comments
    ["image1", "image2"].forEach(id => {
      const q = query(collection(db, "comments", id, "items"));
      const list = document.getElementById(`comments-${id}`);

      onSnapshot(q, (snapshot) => {
        list.innerHTML = "";
        snapshot.forEach(doc => {
          const li = document.createElement("li");
          li.textContent = doc.data().text;
          list.appendChild(li);
        });
      });
    });

    // --- SHARE BUTTON ---
    document.querySelectorAll(".share-btn").forEach(button => {
      button.addEventListener("click", () => {
        const url = window.location.href; // website link
        if (navigator.share) {
          navigator.share({
            title: "Check out this artwork!",
            url: url
          });
        } else {
          navigator.clipboard.writeText(url);
          alert("Link copied! You can share it anywhere.");
        }
      });
    });
  </script>
</body>
</html>
